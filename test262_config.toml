# Test262 Runner Configuration for Otter VM
# This file configures the test262 conformance test runner.

# Path to the test262 directory (relative to project root)
# test262_path = "tests/test262"

# Pin test262 to a specific commit (optional)
# test262_commit = "abc123..."

# Default timeout in seconds per test
timeout_secs = 10

# Directory for saving results
# results_dir = "test262_results"

# Features to skip (tests requiring these features will be skipped).
# Only skip features we truly cannot support (infra gaps or active proposals).
skip_features = [
    # Atomics & shared memory (requires SharedArrayBuffer infra)
    "Atomics",
    "Atomics.pause",
    "SharedArrayBuffer",

    # Decorators (Stage 3, not yet standardized)
    "decorators",

    # Module system (requires module loader in test262 harness)
    "import-assertions",
    "import-attributes",
    "import-bytes",
    "import-defer",
    "dynamic-import",
    "import.meta",
    "json-modules",
    "source-phase-imports",
    "source-phase-imports-module-source",
    "export-star-as-namespace-from-module",
    "top-level-await",

    # FinalizationRegistry / WeakRef (GC-dependent, not yet implemented)
    "FinalizationRegistry",
    "WeakRef",
    "host-gc-required",

    # ShadowRealm (proposal)
    "ShadowRealm",
    "cross-realm",

    # Explicit resource management (using/await using)
    "explicit-resource-management",

    # Tail calls (engine architecture)
    "tail-call-optimization",

    # Resizable / immutable ArrayBuffer (not yet implemented)
    "resizable-arraybuffer",
    "arraybuffer-transfer",
    "immutable-arraybuffer",

    # Iterator helpers & sequencing (ES2025, not yet implemented)
    "iterator-helpers",
    "iterator-sequencing",
    "joint-iteration",

    # Hashbang (parser feature)
    "hashbang",

    # Active proposals (not yet standardized)
    "Array.fromAsync",
    "Error.isError",
    "Float16Array",
    "Math.sumPrecise",
    "RegExp.escape",
    "upsert",
    "uint8array-base64",
    "import-bytes",
    "import-defer",
]

# Test path patterns to ignore (tests matching these patterns will be skipped)
ignored_tests = [
    # SpiderMonkey staging tests use SM-specific harness functions (diff, etc.)
    "staging/sm/Math",

    # oxc parser rejects sloppy-mode call expression as assignment target (Annex B)
    "assignmenttargettype/callexpression",
    "assignmenttargettype/cover-callexpression",

    # yield* delegation not yet implemented (missing throw/return forwarding)
    "yield/star-iterable-throw-emulates-undefined",
    "yield/star-iterable-return-emulates-undefined",

    # Global object missing Object.prototype in prototype chain
    "decodeURIComponent/S15.1.3.2_A5.5",

    # Heavy 4-byte UTF-8 iteration test â€” too slow in debug builds
    "decodeURIComponent/S15.1.3.2_A2.5_T1",
]

# Tests known to panic/crash the VM (will be skipped with a warning)
known_panics = [
    # Stack overflow in regress crate with 200 nested parens
    "S15.10.2.8_A3_T15",
    "S15.10.2.8_A3_T16",
    # Unicode property-escapes generated tests build huge strings, cause OOM/GC crash
    "RegExp/property-escapes/generated",
]
