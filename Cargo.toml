[workspace]
resolver = "2"
members = [
    "crates/otter-vm-bytecode",
    "crates/otter-vm-core",
    "crates/otter-vm-compiler",
    "crates/otter-vm-gc",
    "crates/otter-vm-runtime",
    "crates/otter-profiler",
    "crates/otter-test262",
    "crates/otter-macros",
    "crates/otter-engine",
    "crates/otter-sql",
    "crates/otter-kv",
    "crates/otter-pm",
    "crates/otter-nodejs",
    "crates/otterjs",
]

[workspace.dependencies]
thiserror = "2"

# Optimized release profile for minimal startup time
[profile.release]
lto = "thin"           # Link-time optimization (improves code layout)
codegen-units = 1      # Single codegen unit (better inlining, worse compile time)
strip = false          # Keep symbols for profiling
debug = true           # Include debug info for flamegraph
panic = "abort"        # No unwinding (smaller binary)
opt-level = 3          # Maximum optimization

# Release profile for test262 runner â€” needs panic=unwind for catch_unwind
[profile.test262]
inherits = "release"
panic = "unwind"

# Fast release for development iteration
[profile.release-fast]
inherits = "release"
lto = false
codegen-units = 16
strip = false

# Profile for flamegraph with debug symbols
[profile.dev]
debug = true
strip = false
